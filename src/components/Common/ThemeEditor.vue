<template>
  <div class="theme-editor">
    <div class="editor-header">
      <h3>{{ isEditing ? 'ç¼–è¾‘ä¸»é¢˜' : 'åˆ›å»ºä¸»é¢˜' }}</h3>
      <button @click="$emit('close')" class="btn-close">âœ–ï¸</button>
    </div>

    <div class="editor-content">
      <!-- åŸºæœ¬ä¿¡æ¯ -->
      <div class="form-section">
        <h4>åŸºæœ¬ä¿¡æ¯</h4>
        <div class="form-group">
          <label>ä¸»é¢˜åç§°</label>
          <input v-model="themeData.name" type="text" placeholder="è¾“å…¥ä¸»é¢˜åç§°" />
        </div>
        <div class="form-group">
          <label>ä¸»é¢˜ç±»å‹</label>
          <select v-model="themeData.type">
            <option value="dark">æ·±è‰²</option>
            <option value="light">æµ…è‰²</option>
          </select>
        </div>
      </div>

      <!-- é¢œè‰²é…ç½® -->
      <div class="form-section">
        <h4>ä¸»è‰²è°?/h4>
        <div class="color-grid">
          <div class="color-item">
            <label>ä¸»è‰²</label>
            <input v-model="themeData.colors.primary" type="color" />
            <input v-model="themeData.colors.primary" type="text" class="color-input" />
          </div>
          <div class="color-item">
            <label>æ‚¬åœè‰?/label>
            <input v-model="themeData.colors.primaryHover" type="color" />
            <input v-model="themeData.colors.primaryHover" type="text" class="color-input" />
          </div>
          <div class="color-item">
            <label>æ¿€æ´»è‰²</label>
            <input v-model="themeData.colors.primaryActive" type="color" />
            <input v-model="themeData.colors.primaryActive" type="text" class="color-input" />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h4>èƒŒæ™¯è‰?/h4>
        <div class="color-grid">
          <div class="color-item">
            <label>ä¸»èƒŒæ™?/label>
            <input v-model="themeData.colors.bgPrimary" type="color" />
            <input v-model="themeData.colors.bgPrimary" type="text" class="color-input" />
          </div>
          <div class="color-item">
            <label>æ¬¡èƒŒæ™?/label>
            <input v-model="themeData.colors.bgSecondary" type="color" />
            <input v-model="themeData.colors.bgSecondary" type="text" class="color-input" />
          </div>
          <div class="color-item">
            <label>ä¸‰çº§èƒŒæ™¯</label>
            <input v-model="themeData.colors.bgTertiary" type="color" />
            <input v-model="themeData.colors.bgTertiary" type="text" class="color-input" />
          </div>
          <div class="color-item">
            <label>æ‚¬åœèƒŒæ™¯</label>
            <input v-model="themeData.colors.bgHover" type="color" />
            <input v-model="themeData.colors.bgHover" type="text" class="color-input" />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h4>æ–‡æœ¬è‰?/h4>
        <div class="color-grid">
          <div class="color-item">
            <label>ä¸»æ–‡æœ?/label>
            <input v-model="themeData.colors.textPrimary" type="color" />
            <input v-model="themeData.colors.textPrimary" type="text" class="color-input" />
          </div>
          <div class="color-item">
            <label>æ¬¡æ–‡æœ?/label>
            <input v-model="themeData.colors.textSecondary" type="color" />
            <input v-model="themeData.colors.textSecondary" type="text" class="color-input" />
          </div>
          <div class="color-item">
            <label>ä¸‰çº§æ–‡æœ¬</label>
            <input v-model="themeData.colors.textTertiary" type="color" />
            <input v-model="themeData.colors.textTertiary" type="text" class="color-input" />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h4>çŠ¶æ€è‰²</h4>
        <div class="color-grid">
          <div class="color-item">
            <label>æˆåŠŸ</label>
            <input v-model="themeData.colors.successColor" type="color" />
            <input v-model="themeData.colors.successColor" type="text" class="color-input" />
          </div>
          <div class="color-item">
            <label>è­¦å‘Š</label>
            <input v-model="themeData.colors.warningColor" type="color" />
            <input v-model="themeData.colors.warningColor" type="text" class="color-input" />
          </div>
          <div class="color-item">
            <label>é”™è¯¯</label>
            <input v-model="themeData.colors.errorColor" type="color" />
            <input v-model="themeData.colors.errorColor" type="text" class="color-input" />
          </div>
          <div class="color-item">
            <label>ä¿¡æ¯</label>
            <input v-model="themeData.colors.infoColor" type="color" />
            <input v-model="themeData.colors.infoColor" type="text" class="color-input" />
          </div>
        </div>
      </div>

      <!-- é¢„è§ˆ -->
      <div class="form-section">
        <h4>é¢„è§ˆ</h4>
        <div class="theme-preview" :style="previewStyle">
          <div class="preview-card">
            <div class="preview-header">
              <span>é¢„è§ˆçª—å£</span>
              <button class="preview-btn">æŒ‰é’®</button>
            </div>
            <div class="preview-content">
              <p class="preview-text-primary">ä¸»è¦æ–‡æœ¬</p>
              <p class="preview-text-secondary">æ¬¡è¦æ–‡æœ¬</p>
              <p class="preview-text-tertiary">ä¸‰çº§æ–‡æœ¬</p>
            </div>
            <div class="preview-status">
              <span class="status-success">âœ?æˆåŠŸ</span>
              <span class="status-warning">âš?è­¦å‘Š</span>
              <span class="status-error">âœ?é”™è¯¯</span>
              <span class="status-info">â„?ä¿¡æ¯</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="editor-footer">
      <button @click="$emit('close')" class="btn-secondary">å–æ¶ˆ</button>
      <button @click="handleSave" class="btn-primary">ä¿å­˜</button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue'
import type { Theme } from '@/utils/theme-manager'

interface Props {
  theme?: Theme
}

const props = defineProps<Props>()
const emit = defineEmits<{
  save: [theme: Omit<Theme, 'id'>]
  close: []
}>()

const isEditing = computed(() => !!props.theme)

// åˆå§‹åŒ–ä¸»é¢˜æ•°æ?
const themeData = ref<Omit<Theme, 'id'>>({
  name: props.theme?.name || 'æ–°ä¸»é¢?,
  type: props.theme?.type || 'dark',
  colors: props.theme?.colors || {
    primary: '#3b82f6',
    primaryHover: '#2563eb',
    primaryActive: '#1d4ed8',
    bgPrimary: '#1e1e1e',
    bgSecondary: '#252526',
    bgTertiary: '#2d2d30',
    bgHover: '#2a2d2e',
    bgElevated: '#323233',
    textPrimary: '#cccccc',
    textSecondary: '#9d9d9d',
    textTertiary: '#6e6e6e',
    borderColor: '#3e3e42',
    borderColorHover: '#4e4e52',
    successColor: '#10b981',
    warningColor: '#f59e0b',
    errorColor: '#ef4444',
    infoColor: '#3b82f6',
    terminalBackground: '#1e1e1e',
    terminalForeground: '#cccccc',
    terminalCursor: '#ffffff',
    terminalSelection: 'rgba(255, 255, 255, 0.3)',
    ansiBlack: '#000000',
    ansiRed: '#cd3131',
    ansiGreen: '#0dbc79',
    ansiYellow: '#e5e510',
    ansiBlue: '#2472c8',
    ansiMagenta: '#bc3fbc',
    ansiCyan: '#11a8cd',
    ansiWhite: '#e5e5e5',
    ansiBrightBlack: '#666666',
    ansiBrightRed: '#f14c4c',
    ansiBrightGreen: '#23d18b',
    ansiBrightYellow: '#f5f543',
    ansiBrightBlue: '#3b8eea',
    ansiBrightMagenta: '#d670d6',
    ansiBrightCyan: '#29b8db',
    ansiBrightWhite: '#ffffff'
  }
})

// é¢„è§ˆæ ·å¼
const previewStyle = computed(() => ({
  '--preview-bg-primary': themeData.value.colors.bgPrimary,
  '--preview-bg-secondary': themeData.value.colors.bgSecondary,
  '--preview-text-primary': themeData.value.colors.textPrimary,
  '--preview-text-secondary': themeData.value.colors.textSecondary,
  '--preview-text-tertiary': themeData.value.colors.textTertiary,
  '--preview-primary': themeData.value.colors.primary,
  '--preview-success': themeData.value.colors.successColor,
  '--preview-warning': themeData.value.colors.warningColor,
  '--preview-error': themeData.value.colors.errorColor,
  '--preview-info': themeData.value.colors.infoColor
}))

const handleSave = () => {
  emit('save', themeData.value)
}
</script>

<style scoped>
.theme-editor {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: var(--bg-primary);
}

.editor-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid var(--border-color);
}

.editor-header h3 {
  margin: 0;
  font-size: var(--text-xl);
}

.btn-close {
  background: transparent;
  border: none;
  font-size: var(--text-xl);
  cursor: pointer;
  padding: 4px 8px;
  border-radius: 4px;
  transition: background 0.2s;
}

.btn-close:hover {
  background: var(--bg-hover);
}

.editor-content {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}

.form-section {
  margin-bottom: 24px;
}

.form-section h4 {
  margin: 0 0 12px 0;
  font-size: var(--text-base);
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
}

.form-group {
  margin-bottom: 16px;
}

.form-group label {
  display: block;
  margin-bottom: 6px;
  font-size: var(--text-base);
  color: var(--text-secondary);
}

.form-group input[type="text"],
.form-group select {
  width: 100%;
  padding: 8px 12px;
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-primary);
  font-size: var(--text-base);
}

.color-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 12px;
}

.color-item {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.color-item label {
  font-size: var(--text-sm);
  color: var(--text-secondary);
}

.color-item input[type="color"] {
  width: 100%;
  height: 40px;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  cursor: pointer;
}

.color-input {
  padding: 6px 8px;
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-primary);
  font-size: var(--text-sm);
  font-family: monospace;
}

.theme-preview {
  padding: 20px;
  background: var(--preview-bg-primary);
  border-radius: 8px;
  border: 1px solid var(--border-color);
}

.preview-card {
  background: var(--preview-bg-secondary);
  border-radius: 6px;
  padding: 16px;
}

.preview-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
  color: var(--preview-text-primary);
}

.preview-btn {
  padding: 6px 12px;
  background: var(--preview-primary);
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.preview-content {
  margin-bottom: 12px;
}

.preview-text-primary {
  color: var(--preview-text-primary);
  margin: 4px 0;
}

.preview-text-secondary {
  color: var(--preview-text-secondary);
  margin: 4px 0;
}

.preview-text-tertiary {
  color: var(--preview-text-tertiary);
  margin: 4px 0;
}

.preview-status {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.preview-status span {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: var(--text-sm);
}

.status-success {
  background: var(--preview-success);
  color: white;
}

.status-warning {
  background: var(--preview-warning);
  color: white;
}

.status-error {
  background: var(--preview-error);
  color: white;
}

.status-info {
  background: var(--preview-info);
  color: white;
}

.editor-footer {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  padding: 16px 20px;
  border-top: 1px solid var(--border-color);
}

.btn-primary,
.btn-secondary {
  padding: 8px 16px;
  border-radius: 4px;
  border: none;
  cursor: pointer;
  font-size: var(--text-base);
  transition: all 0.2s;
}

.btn-primary {
  background: var(--primary-color);
  color: white;
}

.btn-primary:hover {
  background: var(--primary-hover);
}

.btn-secondary {
  background: var(--bg-secondary);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
}

.btn-secondary:hover {
  background: var(--bg-hover);
}
</style>
